FROM node:22-alpine

ARG DB_HOST
ARG DB_USERNAME
ARG DB_PASSWORD
ARG DB_NAME
ARG AWS_RAW_SQS_URL
ARG AWS_CLEAN_SQS_URL

ENV DB_HOST=$DB_HOST
ENV DB_USERNAME=$DB_USERNAME
ENV DB_NAME=$DB_NAME
ENV DB_PASSWORD=$DB_PASSWORD
ENV AWS_RAW_SQS_URL=$AWS_RAW_SQS_URL
ENV AWS_CLEAN_SQS_URL=$AWS_CLEAN_SQS_URL

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY dist ./dist
COPY public ./public
COPY .env ./.env

EXPOSE 3000

CMD ["node", "dist/main.js"]
